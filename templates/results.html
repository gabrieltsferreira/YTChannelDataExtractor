<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../static/css/results.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <title>{{ channel_info['channel_name'] }}'s Channel Analytics</title>
</head>
<body>
    <div class="content">
        <div class="upper-content">
            <div class="channel_info_head">
                <div class="profile">
                    <div class="channel_title">
                        {{ channel_info['channel_name'] }}
                    </div>
                    <div class="profile_pic">
                        <img src=" {{ channel_info['profile_pic_url'] }} ">
                    </div>
                </div>                          
            </div>        
            <div class="channel_info_itens">
                <div class="info_item">
                    <div class="info_item_icon">
                        <i class="fa-solid fa-users"></i>
                    </div>
                    <div class="info_item_title">
                        Subscribers
                    </div>
                    <div class="info_item_display">
                        {{ channel_info['subscribers'] }}
                    </div>
                </div>

                <div class="info_item">
                    <div class="info_item_icon">
                        <i class="fa-solid fa-eye"></i>
                    </div>
                    <div class="info_item_title">
                        Total views
                    </div>
                    <div class="info_item_display">
                        {{ channel_info['total_views'] }}
                    </div>
                </div>

                <div class="info_item">
                    <div class="info_item_icon">
                        <i class="fa-solid fa-thumbs-up"></i>
                    </div>
                    <div class="info_item_title">
                        Total likes
                    </div>
                    <div class="info_item_display">
                        {{ insights['total_likes'] }}
                    </div>
                </div>

                <div class="info_item">
                    <div class="info_item_icon">
                        <i class="fa-solid fa-upload"></i>
                    </div>
                    <div class="info_item_title">
                        Uploads
                    </div>
                    <div class="info_item_display">
                        {{ channel_info['videos_count'] }}
                    </div>
                </div>

                <div class="info_item">
                    <div class="info_item_icon">
                        <i class="fa-solid fa-earth-americas"></i>
                    </div>
                    <div class="info_item_title">
                        Country
                    </div>
                    <div class="info_item_display">
                        {{ channel_info['country'] }}
                    </div>
                </div>
            </div>       
        </div>
        <div class="charts-content" style="position: relative; height:40vh; width:80vw">
            <canvas id="WeekdayUploads"></canvas>
            <canvas id="TimeUploads"></canvas>
        </div>      
    </div>
</body>    
</html>


<script type="text/javascript">
    // Convert flask object to JSON
    insights = JSON.parse('{{ insights | tojson }}')

    console.log(insights)

    // Weekday Uploads Chart --------//--------//--------//--------//
    weekdays = insights.weekdays_dist

    new Chart(document.getElementById('WeekdayUploads'), {
        type: 'bar',
        data: {
            labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
            datasets: [{
                label: 'Weekday Uploads',
                data: weekdays,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.5)',
                    'rgba(255, 159, 64, 0.5)',
                    'rgba(255, 205, 86, 0.5)',
                    'rgba(75, 192, 192, 0.5)',
                    'rgba(54, 162, 235, 0.5)',
                    'rgba(153, 102, 255, 0.5)',
                    'rgba(201, 203, 207, 0.5)'
                ],
                borderColor: [
                    'rgb(255, 99, 132)',
                    'rgb(255, 159, 64)',
                    'rgb(255, 205, 86)',
                    'rgb(75, 192, 192)',
                    'rgb(54, 162, 235)',
                    'rgb(153, 102, 255)',
                    'rgb(201, 203, 207)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });


    // Time Uploads Chart --------//--------//--------//--------//
    dates = insights.dates
    times = insights.times

    let data = dates.map((dates, index) => ({
        x: moment(`${dates}`), 
        y: moment(`1970-02-01 ${times[index]}`).valueOf()
    }));

    new Chart(document.getElementById('TimeUploads'), {
        type: 'line',  
        data: {
            labels: insights.dates,
            datasets: [{
                label: 'Upload Time',
                data: data,
                fill: false,
                backgroundColor: 'green',
                borderColor: 'green'
            }]
        },
        options: {
            responsive: true,
            title: {
                display: false
            },
            legend: {
                display: false
            },
            scales: {
                y: {
                    ticks: {
                        min: moment('1970-02-01 00:00:00').valueOf(),
                        max: moment('1970-02-01 23:59:59').valueOf(),
                        stepSize: 3.6e+6,                       
                        callback: function(value) {                       
                            let time = moment(value)                   
                            return time.format('h A');
                        }
                    }
                },

            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            value = context.parsed.y
                            let time = moment(value)                   
                            return time.format('HH:mm');
                        }
                    }
                }
            }
        }
    });


</script>